services:
  backend:
    build:
      context: ./backend_fastapi
      dockerfile: Dockerfile

    container_name: dataops_backend

    ports:
      - "8000:8000"

    environment:
      DATABASE_URL: sqlite+aiosqlite:///./data/dataops.db
      LOG_LEVEL: INFO

    volumes:
      - ./backend_fastapi/data:/app/data
      - ./backend_fastapi/exports:/app/exports

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health/liveness"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 30s


  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile

    container_name: dataops_frontend

    ports:
      - "3000:3000"

    environment:
      NEXT_PUBLIC_API_URL: http://localhost:8000

    depends_on:
      backend:
        condition: service_healthy

